import{y as D,_ as Pu,d as Lu,r as c,a as ou,k as Su,b as zu,c as t,w as e,M as r,j as i,o as m,u as p,L as J,p as n,m as f,t as _,q as E,N as nu,O as Mu,G as Q,P as Ku,H as Ou,J as Uu,e as b,K as ju,C as lu}from"./index.0310409c.js";const qu=l=>D.post("/wx/cascade/nodes",l),Gu=l=>{const B={};return l!==void 0&&(B.node_type=l),D.get("/wx/cascade/nodes",{params:B})},Hu=(l,B)=>D.put(`/wx/cascade/nodes/${l}`,B),Ju=l=>D.delete(`/wx/cascade/nodes/${l}`),Qu=l=>D.post(`/wx/cascade/nodes/${l}/credentials`),Ru=(l,B)=>D.post(`/wx/cascade/nodes/${l}/test-connection`,B),Wu=l=>D.get("/wx/cascade/sync-logs",{params:l}),Xu=l=>D.get("/wx/cascade/allocations",{params:l}),Yu=l=>{const B=l?`/wx/cascade/dispatch-task?task_id=${l}`:"/wx/cascade/dispatch-task";return D.post(B)};const Zu={class:"cascade-management"},ue={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ee={style:{display:"flex","justify-content":"space-between","align-items":"center"}},te=Lu({__name:"CascadeManagement",setup(l){const B=[{title:"\u8282\u70B9\u540D\u79F0",dataIndex:"name"},{title:"\u8282\u70B9\u7C7B\u578B",slotName:"node_type"},{title:"API\u5730\u5740",dataIndex:"api_url",ellipsis:!0},{title:"API Key",dataIndex:"api_key",width:"15%",ellipsis:!0},{title:"\u72B6\u6001",slotName:"status"},{title:"\u6700\u540E\u5FC3\u8DF3",slotName:"last_heartbeat_at"},{title:"\u6700\u540E\u540C\u6B65",slotName:"last_sync_at"},{title:"\u64CD\u4F5C",slotName:"action",width:"15%"}],su=[{title:"\u64CD\u4F5C\u7C7B\u578B",dataIndex:"operation"},{title:"\u65B9\u5411",slotName:"direction"},{title:"\u72B6\u6001",slotName:"status"},{title:"\u6570\u636E\u91CF",dataIndex:"data_count"},{title:"\u5F00\u59CB\u65F6\u95F4",dataIndex:"started_at"},{title:"\u5B8C\u6210\u65F6\u95F4",dataIndex:"completed_at"}],iu=[{title:"\u5206\u914DID",dataIndex:"allocation_id",ellipsis:!0,width:120},{title:"\u4EFB\u52A1ID",dataIndex:"task_id",ellipsis:!0,width:120},{title:"\u8282\u70B9\u540D\u79F0",dataIndex:"node_name"},{title:"\u516C\u4F17\u53F7\u6570",dataIndex:"feed_ids",slotName:"feed_count"},{title:"\u72B6\u6001",slotName:"allocation_status"},{title:"\u521B\u5EFA\u65F6\u95F4",slotName:"created_at"},{title:"\u66F4\u65B0\u65F6\u95F4",slotName:"updated_at"}],M=c([]),K=c([]),O=c([]),R=c(0),ru=c(0),I=c(!1),h=c(!1),N=c(!1),V=c(!1),F=c(""),k=c(!1),T=c("\u521B\u5EFA\u8282\u70B9"),P=c(null),U=c(!1),v=c({api_key:"",api_secret:""}),W=c("nodes"),s=ou({node_type:1,name:"",description:"",api_url:""}),C=ou({limit:20,offset:0}),L=async()=>{try{I.value=!0,F.value="";const u=await Gu();M.value=u||[]}catch(u){F.value=u instanceof Error?u.message:"\u83B7\u53D6\u8282\u70B9\u5217\u8868\u5931\u8D25"}finally{I.value=!1}},X=async()=>{try{h.value=!0;const u=await Wu({limit:C.limit,offset:C.offset});K.value=(u==null?void 0:u.list)||[],R.value=(u==null?void 0:u.total)||0}catch(u){console.error("\u83B7\u53D6\u540C\u6B65\u65E5\u5FD7\u5931\u8D25:",u)}finally{h.value=!1}},j=async()=>{try{N.value=!0;const u=await Xu({limit:50});O.value=(u==null?void 0:u.list)||[],ru.value=(u==null?void 0:u.total)||0}catch(u){console.error("\u83B7\u53D6\u4EFB\u52A1\u5206\u914D\u5931\u8D25:",u)}finally{N.value=!1}},Y=async()=>{try{V.value=!0;const u=await Yu();if(u){const{online_nodes:a,task_count:d,tasks:y,allocations_created:g}=u;a===0?r.warning("\u6CA1\u6709\u5728\u7EBF\u7684\u5B50\u8282\u70B9\uFF0C\u8BF7\u786E\u4FDD\u5B50\u8282\u70B9\u5DF2\u542F\u52A8\u5E76\u8FDE\u63A5"):d===0?r.warning("\u6CA1\u6709\u53EF\u5206\u53D1\u7684\u4EFB\u52A1\u3002\u8BF7\u5148\u521B\u5EFA\u6D88\u606F\u4EFB\u52A1\u5E76\u5173\u8054\u516C\u4F17\u53F7"):g===0?r.warning(`\u53D1\u73B0 ${d} \u4E2A\u4EFB\u52A1\uFF0C\u4F46\u6CA1\u6709\u521B\u5EFA\u5206\u914D\u3002\u53EF\u80FD\u662F\u4EFB\u52A1\u6CA1\u6709\u5173\u8054\u516C\u4F17\u53F7\u6216\u8282\u70B9\u5BB9\u91CF\u4E0D\u8DB3`):r.success(`\u5206\u53D1\u6210\u529F\uFF1A${g} \u4E2A\u5206\u914D\u5DF2\u521B\u5EFA\uFF0C\u6D89\u53CA ${d} \u4E2A\u4EFB\u52A1`),console.log("\u5206\u53D1\u7ED3\u679C:",u)}j()}catch(u){r.error("\u4EFB\u52A1\u5206\u53D1\u5931\u8D25: "+(u instanceof Error?u.message:"\u672A\u77E5\u9519\u8BEF"))}finally{V.value=!1}},du=()=>{T.value="\u521B\u5EFA\u8282\u70B9",P.value=null,Object.assign(s,{node_type:1,name:"",description:"",api_url:""}),k.value=!0},cu=u=>{T.value="\u7F16\u8F91\u8282\u70B9",P.value=u,Object.assign(s,{node_type:u.node_type,name:u.name,description:u.description||"",api_url:u.api_url||""}),k.value=!0},Z=async()=>{try{if(!s.name.trim()){r.error("\u8BF7\u8F93\u5165\u8282\u70B9\u540D\u79F0");return}if(T.value==="\u521B\u5EFA\u8282\u70B9"){const u={node_type:s.node_type,name:s.name,description:s.description,api_url:s.api_url||void 0};await qu(u),r.success("\u521B\u5EFA\u6210\u529F")}else if(P.value){const u={name:s.name,description:s.description,api_url:s.api_url||void 0};await Hu(P.value.id,u),r.success("\u66F4\u65B0\u6210\u529F")}k.value=!1,L()}catch(u){F.value=u instanceof Error?u.message:"\u64CD\u4F5C\u5931\u8D25",r.error(F.value)}},_u=u=>{lu.confirm({title:"\u5220\u9664\u8282\u70B9",content:`\u786E\u5B9A\u8981\u5220\u9664 "${u.name}" \u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002`,okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",okButtonProps:{status:"danger"},onOk:async()=>{try{await Ju(u.id),r.success("\u5DF2\u5220\u9664"),L()}catch(a){F.value=a instanceof Error?a.message:"\u5220\u9664\u5931\u8D25",r.error(F.value)}}})},pu=async u=>{lu.confirm({title:"\u751F\u6210\u51ED\u8BC1",content:`\u4E3A\u8282\u70B9 "${u.name}" \u751F\u6210\u65B0\u7684 API \u51ED\u8BC1\u3002\u65E7\u51ED\u8BC1\u5C06\u5931\u6548\uFF0C\u786E\u5B9A\u7EE7\u7EED\u5417\uFF1F`,okText:"\u751F\u6210",cancelText:"\u53D6\u6D88",okButtonProps:{status:"warning"},onOk:async()=>{try{const a=await Qu(u.id);v.value=a,U.value=!0}catch(a){F.value=a instanceof Error?a.message:"\u751F\u6210\u51ED\u8BC1\u5931\u8D25",r.error(F.value)}}})},Fu=async u=>{r.loading({content:"\u6D4B\u8BD5\u8FDE\u63A5\u4E2D...",id:"test-connection"});try{await Ru(u.id),r.success({content:"\u8FDE\u63A5\u6D4B\u8BD5\u6210\u529F",id:"test-connection"})}catch(a){r.error({content:"\u8FDE\u63A5\u6D4B\u8BD5\u5931\u8D25: "+(a instanceof Error?a.message:"\u672A\u77E5\u9519\u8BEF"),id:"test-connection"})}},S=u=>{navigator.clipboard.writeText(u).then(()=>{r.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{r.error("\u590D\u5236\u5931\u8D25")})},Bu=()=>{const u=`API Key: ${v.value.api_key}
API Secret: ${v.value.api_secret}`;S(u),r.success("\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")},x=u=>{if(!u)return"-";try{return new Date(u).toLocaleString("zh-CN")}catch{return"-"}},mu=u=>u===0?"\u7236\u8282\u70B9":"\u5B50\u8282\u70B9",fu=u=>u===0?"blue":"green",Eu=u=>u===1?"green":"red",Du=u=>u===1?"\u5728\u7EBF":"\u79BB\u7EBF",yu=u=>({pull:"\u62C9\u53D6",push:"\u63A8\u9001"})[u]||u,vu=u=>u==="pull"?"blue":"green",Cu=u=>u===1?"green":u===-1?"red":"gray",gu=u=>u===1?"\u6210\u529F":u===-1?"\u5931\u8D25":"\u8FDB\u884C\u4E2D",Au=u=>({pending:"orange",executing:"blue",completed:"green",failed:"red"})[u]||"gray",ku=u=>({pending:"\u5F85\u6267\u884C",executing:"\u6267\u884C\u4E2D",completed:"\u5DF2\u5B8C\u6210",failed:"\u5931\u8D25"})[u]||u,xu=u=>{C.offset=(u-1)*C.limit,X()},wu=u=>{u==="logs"?X():u==="allocations"&&j()};return Su(()=>{L()}),(u,a)=>{const d=i("a-button"),y=i("a-space"),g=i("a-alert"),$=i("a-tooltip"),w=i("a-tag"),bu=i("a-popconfirm"),q=i("a-table"),G=i("a-empty"),H=i("a-tab-pane"),Iu=i("a-tabs"),Nu=i("a-card"),uu=i("a-radio"),Tu=i("a-radio-group"),z=i("a-form-item"),eu=i("a-input"),$u=i("a-textarea"),hu=i("a-form"),tu=i("a-modal"),au=i("a-descriptions-item"),Vu=i("a-descriptions");return m(),zu("div",Zu,[t(Nu,{title:"\u7EA7\u8054\u8282\u70B9\u7BA1\u7406",bordered:!1},{extra:e(()=>[t(y,null,{default:e(()=>[t(d,{onClick:L,loading:I.value},{icon:e(()=>[t(p(J))]),default:e(()=>[a[11]||(a[11]=n(" \u5237\u65B0 "))]),_:1,__:[11]},8,["loading"]),t(d,{type:"primary",onClick:du},{default:e(()=>a[12]||(a[12]=[n("+ \u521B\u5EFA\u8282\u70B9")])),_:1,__:[12]})]),_:1})]),default:e(()=>[t(Iu,{"active-key":W.value,"onUpdate:activeKey":a[1]||(a[1]=o=>W.value=o),onChange:wu},{default:e(()=>[t(H,{key:"nodes",title:"\u8282\u70B9\u5217\u8868"},{default:e(()=>[t(y,{direction:"vertical",fill:""},{default:e(()=>[F.value?(m(),f(g,{key:0,type:"error","show-icon":"",closable:"",onClose:a[0]||(a[0]=o=>F.value="")},{default:e(()=>[n(_(F.value),1)]),_:1})):E("",!0),t(g,{type:"info","show-icon":""},{default:e(()=>a[13]||(a[13]=[n(" \u7EA7\u8054\u7CFB\u7EDF\u652F\u6301\u7236\u5B50\u8282\u70B9\u67B6\u6784\u3002\u7236\u8282\u70B9\u8D1F\u8D23\u7EDF\u4E00\u7BA1\u7406\u6570\u636E\uFF0C\u5B50\u8282\u70B9\u4ECE\u7236\u8282\u70B9\u540C\u6B65\u5E76\u6267\u884C\u4EFB\u52A1\u3002 ")])),_:1,__:[13]}),t(y,null,{default:e(()=>[t(d,{type:"primary",loading:V.value,onClick:Y},{icon:e(()=>[t(p(nu))]),default:e(()=>[a[14]||(a[14]=n(" \u5206\u53D1\u4EFB\u52A1 "))]),_:1,__:[14]},8,["loading"]),t($,{content:"\u5C06\u6D88\u606F\u4EFB\u52A1\u5206\u914D\u7ED9\u5728\u7EBF\u7684\u5B50\u8282\u70B9\u6267\u884C"},{default:e(()=>[t(p(Mu),{style:{color:"#999"}})]),_:1})]),_:1}),t(q,{columns:B,data:M.value,loading:I.value,"row-key":"id",pagination:!1,scroll:{x:1400}},{node_type:e(({record:o})=>[t(w,{color:fu(o.node_type)},{default:e(()=>[n(_(mu(o.node_type)),1)]),_:2},1032,["color"])]),status:e(({record:o})=>[t(w,{color:Eu(o.status)},{default:e(()=>[n(_(Du(o.status)),1)]),_:2},1032,["color"])]),last_heartbeat_at:e(({record:o})=>[n(_(x(o.last_heartbeat_at)),1)]),last_sync_at:e(({record:o})=>[n(_(x(o.last_sync_at)),1)]),action:e(({record:o})=>[t(y,{size:"small"},{default:e(()=>[t($,{content:"\u590D\u5236 API Key"},{default:e(()=>[o.api_key?(m(),f(d,{key:0,type:"text",size:"small",onClick:A=>S(o.api_key||"")},{icon:e(()=>[t(p(Q))]),_:2},1032,["onClick"])):E("",!0)]),_:2},1024),t($,{content:"\u751F\u6210\u51ED\u8BC1"},{default:e(()=>[o.node_type===1?(m(),f(d,{key:0,type:"text",size:"small",onClick:A=>pu(o)},{icon:e(()=>[t(p(Ku))]),_:2},1032,["onClick"])):E("",!0)]),_:2},1024),t($,{content:"\u6D4B\u8BD5\u8FDE\u63A5"},{default:e(()=>[o.node_type===1?(m(),f(d,{key:0,type:"text",size:"small",onClick:A=>Fu(o)},{icon:e(()=>[t(p(J))]),_:2},1032,["onClick"])):E("",!0)]),_:2},1024),t($,{content:"\u7F16\u8F91"},{default:e(()=>[t(d,{type:"text",size:"small",onClick:A=>cu(o)},{icon:e(()=>[t(p(Ou))]),_:2},1032,["onClick"])]),_:2},1024),t(bu,{content:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u5220\u9664","cancel-text":"\u53D6\u6D88",onOk:A=>_u(o)},{default:e(()=>[t(d,{type:"text",size:"small",status:"danger"},{icon:e(()=>[t(p(Uu))]),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1},8,["data","loading"]),!I.value&&M.value.length===0?(m(),f(G,{key:1,description:"\u6682\u65E0\u7EA7\u8054\u8282\u70B9"})):E("",!0)]),_:1})]),_:1}),t(H,{key:"logs",title:"\u540C\u6B65\u65E5\u5FD7"},{default:e(()=>[t(q,{columns:su,data:K.value,loading:h.value,"row-key":"id",pagination:{current:Math.floor(C.offset/C.limit)+1,pageSize:C.limit,total:R.value,showTotal:!0,onChange:xu}},{direction:e(({record:o})=>[t(w,{color:vu(o.direction)},{default:e(()=>[n(_(yu(o.direction)),1)]),_:2},1032,["color"])]),status:e(({record:o})=>[t(w,{color:Cu(o.status)},{default:e(()=>[n(_(gu(o.status)),1)]),_:2},1032,["color"])]),started_at:e(({record:o})=>[n(_(x(o.started_at)),1)]),completed_at:e(({record:o})=>[n(_(x(o.completed_at)),1)]),_:1},8,["data","loading","pagination"]),!h.value&&K.value.length===0?(m(),f(G,{key:0,description:"\u6682\u65E0\u540C\u6B65\u65E5\u5FD7"})):E("",!0)]),_:1}),t(H,{key:"allocations",title:"\u4EFB\u52A1\u5206\u914D"},{default:e(()=>[t(y,{direction:"vertical",fill:""},{default:e(()=>[t(y,null,{default:e(()=>[t(d,{type:"primary",loading:V.value,onClick:Y},{icon:e(()=>[t(p(nu))]),default:e(()=>[a[15]||(a[15]=n(" \u5206\u53D1\u4EFB\u52A1 "))]),_:1,__:[15]},8,["loading"]),t(d,{onClick:j,loading:N.value},{icon:e(()=>[t(p(J))]),default:e(()=>[a[16]||(a[16]=n(" \u5237\u65B0 "))]),_:1,__:[16]},8,["loading"])]),_:1}),t(q,{columns:iu,data:O.value,loading:N.value,"row-key":"allocation_id",pagination:!1},{feed_count:e(({record:o})=>[t(w,{color:"blue"},{default:e(()=>{var A;return[n(_(((A=o.feed_ids)==null?void 0:A.length)||0),1)]}),_:2},1024)]),allocation_status:e(({record:o})=>[t(w,{color:Au(o.status)},{default:e(()=>[n(_(ku(o.status)),1)]),_:2},1032,["color"])]),created_at:e(({record:o})=>[n(_(x(o.created_at)),1)]),updated_at:e(({record:o})=>[n(_(x(o.updated_at)),1)]),_:1},8,["data","loading"]),!N.value&&O.value.length===0?(m(),f(G,{key:0,description:"\u6682\u65E0\u4EFB\u52A1\u5206\u914D\u8BB0\u5F55"})):E("",!0)]),_:1})]),_:1})]),_:1},8,["active-key"])]),_:1}),t(tu,{visible:k.value,"onUpdate:visible":a[6]||(a[6]=o=>k.value=o),title:T.value,width:"600px",onOk:Z,onCancel:a[7]||(a[7]=o=>k.value=!1)},{default:e(()=>[t(hu,{model:s,layout:"vertical"},{default:e(()=>[t(z,{label:"\u8282\u70B9\u7C7B\u578B",field:"node_type",required:""},{default:e(()=>[t(Tu,{modelValue:s.node_type,"onUpdate:modelValue":a[2]||(a[2]=o=>s.node_type=o)},{default:e(()=>[t(uu,{value:0},{default:e(()=>a[17]||(a[17]=[n("\u7236\u8282\u70B9")])),_:1,__:[17]}),t(uu,{value:1},{default:e(()=>a[18]||(a[18]=[n("\u5B50\u8282\u70B9")])),_:1,__:[18]})]),_:1},8,["modelValue"]),a[19]||(a[19]=b("div",{class:"form-hint"},"\u7236\u8282\u70B9\u7528\u4E8E\u7BA1\u7406\u6570\u636E\uFF0C\u5B50\u8282\u70B9\u4ECE\u7236\u8282\u70B9\u540C\u6B65",-1))]),_:1,__:[19]}),t(z,{label:"\u8282\u70B9\u540D\u79F0",field:"name",required:""},{default:e(()=>[t(eu,{modelValue:s.name,"onUpdate:modelValue":a[3]||(a[3]=o=>s.name=o),placeholder:"\u4F8B\u5982\uFF1A\u8282\u70B91",onKeyup:ju(Z,["enter"])},null,8,["modelValue"])]),_:1}),t(z,{label:"\u63CF\u8FF0",field:"description"},{default:e(()=>[t($u,{modelValue:s.description,"onUpdate:modelValue":a[4]||(a[4]=o=>s.description=o),placeholder:"\u53EF\u9009\uFF1A\u8282\u70B9\u8BF4\u660E\u3001\u5907\u6CE8\u7B49",rows:3},null,8,["modelValue"])]),_:1}),s.node_type===1?(m(),f(z,{key:0,label:"API\u5730\u5740",field:"api_url"},{default:e(()=>[t(eu,{modelValue:s.api_url,"onUpdate:modelValue":a[5]||(a[5]=o=>s.api_url=o),placeholder:"\u4F8B\u5982\uFF1Ahttp://node-server:8001"},null,8,["modelValue"]),a[20]||(a[20]=b("div",{class:"form-hint"},"\u5B50\u8282\u70B9\u7684\u670D\u52A1\u5730\u5740\uFF0C\u7528\u4E8E\u8FDE\u63A5\u6D4B\u8BD5",-1))]),_:1,__:[20]})):E("",!0),T.value==="\u521B\u5EFA\u8282\u70B9"?(m(),f(g,{key:1,type:"info","show-icon":""},{default:e(()=>a[21]||(a[21]=[n(" \u521B\u5EFA\u8282\u70B9\u540E\uFF0C\u53EF\u4EE5\u4E3A\u5B50\u8282\u70B9\u751F\u6210\u51ED\u8BC1\u7528\u4E8E\u8FDE\u63A5\u7236\u8282\u70B9 ")])),_:1,__:[21]})):E("",!0)]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(tu,{visible:U.value,"onUpdate:visible":a[10]||(a[10]=o=>U.value=o),title:"\u8282\u70B9\u51ED\u8BC1",width:"600px",footer:!1,closable:!0},{default:e(()=>[t(y,{direction:"vertical",fill:"",size:16},{default:e(()=>[t(g,{type:"warning","show-icon":""},{default:e(()=>a[22]||(a[22]=[n(" API Secret \u53EA\u4F1A\u663E\u793A\u4E00\u6B21\uFF0C\u8BF7\u7ACB\u5373\u590D\u5236\u5E76\u59A5\u5584\u4FDD\u5B58\uFF01 ")])),_:1,__:[22]}),t(Vu,{column:1,bordered:""},{default:e(()=>[t(au,{label:"API Key"},{default:e(()=>[b("div",ue,[b("code",null,_(v.value.api_key),1),t(d,{type:"text",size:"small",onClick:a[8]||(a[8]=o=>S(v.value.api_key))},{icon:e(()=>[t(p(Q))]),_:1})])]),_:1}),t(au,{label:"API Secret"},{default:e(()=>[b("div",ee,[b("code",null,_(v.value.api_secret),1),t(d,{type:"text",size:"small",onClick:a[9]||(a[9]=o=>S(v.value.api_secret))},{icon:e(()=>[t(p(Q))]),_:1})])]),_:1})]),_:1}),t(d,{type:"primary",long:"",onClick:Bu},{default:e(()=>a[23]||(a[23]=[n(" \u590D\u5236\u5168\u90E8 ")])),_:1,__:[23]})]),_:1})]),_:1},8,["visible"])])}}});var oe=Pu(te,[["__scopeId","data-v-44d16a00"]]);export{oe as default};
